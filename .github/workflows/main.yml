name: Sync Releases from Upstream

on:
  schedule:
    - cron: '0 3 * * *'  # æ¯å¤©å‡Œæ™¨3ç‚¹åŒæ­¥ä¸€æ¬¡
  workflow_dispatch:      # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  sync-release:
    runs-on: ubuntu-latest
    steps:
      - name: è·å–æœ€æ–° release æ•°æ®
        uses: actions/github-script@v7
        id: fetch
        with:
          script: |
            const res = await github.rest.repos.getLatestRelease({
              owner: 'heyman',
              repo: 'heynote',
            });
            return res.data.assets.map(asset => asset.browser_download_url);

      - name: ä¸‹è½½ Release æ–‡ä»¶
        run: |
          mkdir -p release_assets
          urls="${{ steps.fetch.outputs.result }}"
          urls=$(echo "$urls" | tr -d '[]"')  # å»é™¤æ‹¬å·å’Œå¼•å·
          IFS=',' read -ra url_array <<< "$urls"
          for url in "${url_array[@]}"; do
            echo "ğŸ“¦ ä¸‹è½½ $url"
            wget -q -P release_assets "$url"
          done

      - name: å‘å¸ƒåˆ°ä½ è‡ªå·±çš„ Release é¡µé¢
        uses: softprops/action-gh-release@v1
        with:
          tag_name: synced-$(date +'%Y%m%d')
          name: Auto Synced Release - $(date +'%Y-%m-%d')
          body: "è‡ªåŠ¨ä»ä¸Šæ¸¸ä»“åº“åŒæ­¥çš„ Release æ–‡ä»¶"
          files: release_assets/*
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
